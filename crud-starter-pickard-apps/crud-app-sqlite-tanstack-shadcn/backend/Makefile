.PHONY: help setup generate run build clean dev

help: ## Show this help message
	@echo "Available commands:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

setup: ## Install dependencies and generate code
	@echo "ğŸ“¦ Installing Go dependencies..."
	go mod download
	@echo "âœ¨ Generating sqlc code..."
	sqlc generate
	@echo "âœ… Setup complete!"

generate: ## Generate sqlc code from SQL queries
	@echo "âœ¨ Generating sqlc code..."
	sqlc generate
	@echo "âœ… Generated code updated in internal/db/"

run: generate ## Generate code and run the server
	@echo "ğŸš€ Starting server..."
	go run ./cmd/server/main.go

dev: generate ## Generate code and run with hot reload
	@echo "ğŸ”¥ Starting with hot reload..."
	air

build: generate ## Generate code and build production binary
	@echo "ğŸ—ï¸  Building production binary..."
	go build -ldflags="-w -s" -o bin/items-api ./cmd/server
	@echo "âœ… Binary created at bin/items-api"

clean: ## Clean generated files and build artifacts
	@echo "ğŸ§¹ Cleaning up..."
	rm -rf bin/
	rm -rf tmp/
	rm -f items-api
	@echo "âœ… Cleaned!"

.DEFAULT_GOAL := help
